<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>KYC</title>

        <!-- green id css -->
        {% if production %}
        <link rel="stylesheet" type="text/css" media="screen" href="https://simpleui-au.vixverify.com/df/assets/stylesheets/greenid.css"/>
        {% else %}
        <link rel="stylesheet" type="text/css" media="screen" href="https://simpleui-test-au.vixverify.com/df/assets/stylesheets/greenid.css"/>
        {% endif %}

        <!-- Bootstrap core CSS -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">

        <!-- jquery UI CSS -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" rel="stylesheet">

        <!-- Site CSS -->
        <link href="/static/css/site.css" rel="stylesheet">

    </head>

    <body>

        <!-- Navigation -->
        <nav class="navbar navbar-inverse">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">
                        KYC
                        {% if not production %}
                        <span class="dev-alert">DEV MODE</span>
                        {% endif %}
                    </a>
                </div>
                <div id="navbar" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <!--
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="#">About</a></li>
                        <li><a href="#">Contact</a></li>
                        -->
                    </ul>
                </div><!--/.nav-collapse -->
            </div>
        </nav>

        <!-- Page Content -->
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    {% if ezypay_verification_message %}
                    <div id="ezypay_verification_message" class="alert alert-danger">
                        {{ ezypay_verification_message }}
                    </div>
                    {% endif %}

                    {% if not completed %}

                    <div id="choose_verification" style="display: none">
						<h3 style="margin-top: 40px;">Do you have a REDRAT EZYPAY Account?</h3>
                        <button type="button" class="btn btn-primary" onclick="chooseEzyPay()">Yes</button>
                        <button type="button" class="btn btn-primary" onclick="chooseGreenId()">No</button>
                    </div>

                    <form id="ezypay_form" method="post" style="display: none">
                        <input type="hidden" id="token" value="{{token}}" name="token"/>
                        <div class="row">
                            <div class="form-group col-sm-6">
                                <label for="ezypayEmail">EZYPAY Email</label>
                                <input type="text" class="form-control" name="ezypayEmail" id="ezypayEmail" value="{{email}}" readonly>
                            </div>
                            <div class="form-group col-sm-6">
                                <label for="ezypayPass">Password</label>
                                <input type="password" class="form-control" name="ezypayPass" id="ezypayPass">
                            </div>
                        </div>
						<div class="row">
							<div class="form-group col-sm-12">
								<input value="Submit" type="submit" id="submitezypay" name="submitezypay" class="btn btn-primary" />
							</div>
						</div>
                    </form>

                    <div id="greenid_continue" style="display: none">
						<h3 style="margin-top: 40px;">Do you want to continue your verification?</h3>
                        <button type="button" class="btn btn-primary" onclick="continueGreenIdVerification()">Yes</button>
                    </div>

                    <div id="greenid_div" style="display: none">
                        {% if not greenid_verification_token %}
						<h3 style="margin-top: 40px;">Provide your details to begin</h3>
                        {% endif %}
					</div>

                    <form id="greenid_init_form" method="post" onsubmit="workoutNZsuburb();" style="display: none">
                        <input type="hidden" id="token" value="{{token}}" name="token"/>
                        <input type="hidden" id="accountId" value="{{account_id}}" name="accountId"/>
                        <input type="hidden" id="apiCode" value="{{api_code}}" name="apiCode"/>
                        <input type="hidden" id="verificationId" value="" name="verificationId"/>
                        <input type="hidden" id="verificationToken" value="" name="verificationToken"/>
                        <input type="hidden" id="usethiscountry" value="NZ" name="country"/>

                        <div class="row">
                            <div class="form-group col-sm-4">
                                <label for="givenNames">First name</label>
                                <input type="text" class="form-control" id="givenNames" placeholder="Enter given name">
                            </div>
                            <div class="form-group col-sm-4">
                                <label for="middleNames">Middle name</label>
                                <input type="text" class="form-control" id="middleNames" placeholder="Enter middle name">
                            </div>
                            <div class="form-group col-sm-4">
                                <label for="surname">Surname</label>
                                <input type="text" class="form-control" id="surname" placeholder="Enter surname">
                            </div>
                        </div>

                        <div id="address-fields">
											
							<div id="address-harmony-div" style="display:none">

                                <hr/>
							
								<div class="row">
									<div class="form-group col-sm-6">
										<label for="fullAddress" class="control-label">Address</label>
					                	<input id="fullAddress" type="text" class="form-control" placeholder="Start typing and select from the list that appears..."/>	
					            	</div>
								</div>
								<input type="hidden" id="nzsuburb"/>
								<input type="hidden" id="nztown"/>
								<input type="hidden" id="nzstreetType"/>
						
							</div>

							<div id="address-non-harmony-div">
						
							<hr/>
							
							<fieldset>
								<label>Address (manual entry)</label>
								
								<div class="row">
					
						            <div class="form-group col-sm-2">
						                <label for="flatNumber" class="control-label">Unit Number</label>
						                <input type="text" id="flatNumber" name="flatNumber" class="form-control"/>
						            </div>
					
						            <div class="form-group col-sm-2">
						                <label for="streetNumber" class="control-label">Street Number</label>
						                <input type="text" id="streetNumber" name="streetNumber" class="form-control"/>
						            </div>
					
						            <div class="form-group col-sm-4">
						                <label for="streetName" class="control-label">Street Name</label>
						                <input type="text" id="streetName" name="streetName" class="form-control"/>
						            </div>
					
						            <div class="form-group col-sm-4">
						                <label for="streetType" class="control-label">Street Type</label>
					                    <select id="streetType" class="form-control">
						                	<option value="" selected="selected">Select your street type...</option>
						                	<option value="AVE">Avenue</option>
											<option value="CIR">Circle</option>
											<option value="CCT">Circuit</option>
											<option value="CL">Close</option>
											<option value="CT">Court</option>
											<option value="CRES">Crescent</option>
											<option value="DR">Drive</option>
											<option value="ESP">Esplanade</option>
											<option value="EXP">Expressway</option>
											<option value="HWY">Highway</option>
											<option value="LANE">Lane</option>
											<option value="MWY">Motorway</option>
											<option value="PDE">Parade</option>
											<option value="PL">Place</option>
											<option value="RD">Road</option>
											<option value="SQ">Square</option>
											<option value="ST">Street</option>
											<option value="TCE">Terrace</option>
											<option value="WAY">Way</option>
					                    </select>
						            </div>
						            
								</div>
								
								<div class="row">
					
						            <div class="form-group col-sm-4">
						                <label for="suburb" class="control-label">Suburb</label>
						                <input type="text" id="suburb" name="suburb" class="form-control"/>
						            </div>
						            
						            <!-- Begin towncity Dropdown -->
									<div class="form-group col-sm-4">
										<label for="townCity" class="control-label">Town/City</label>
										<input type="text" id="townCity" name="townCity" class="form-control"/>
									</div>
						            <!-- End towncity Dropdown -->
						            
	                                					
	
						            <div class="form-group col-sm-2">
						                <label for="postcode" class="control-label">Postcode</label>
						                <input type="text" id="postcode" name="postcode" class="form-control"/>
						            </div>
					            
								</div>
								
							</fieldset>
							
							<hr/>
						</div>	
							
						</div>
						<div id="address-loading-placeholder" style="display:none"><label class="control-label">Address fields loading...</label></div>

                        <div class="row">
							<div class="form-group col-sm-3 col-lg-2">
								<label for="dob" class="control-label">Date of Birth (DD/MM/YYYY)</label>
								<div class="input-group date">
									<input type="text" name="dob" id="dob" class="form-control" aria-required="true" />
									<span class="input-group-addon datepicker"><span class="glyphicon glyphicon-calendar"></span></span>
								</div>
							</div>
						</div>
						
						<div class="row" style="margin-bottom: 20px">
				            <div class="form-group col-sm-6">
				                <label for="email" class="control-label">Email</label>
                                <input type="text" id="email" name="email" class="form-control" value="{{email}}">
				            </div>
						</div>
						
						<div class="row">
							<div class="form-group col-sm-12">
								<input value="Submit details" type="submit" id="submitbob" name="submitbob" class="btn btn-primary" />
							</div>
						</div>
                    </form>
                    {% else %}
                    <h3 style="margin-top: 40px;">Kyc Completed</h3>
                    <p>
                    Your identity verification is complete.<span id="return-to-parent" style="display: none"> You can return to <a href="{{parent_site}}">{{parent_site}}</a>.</span>
                    </p>
                    <p>Thank-you.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Bootstrap core JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <!-- jquery ui -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

        <!-- datepicker -->
        <script src="/static/js/bootstrap-datepicker.js"></script>

        <!-- green id helper stuff -->
        <script src="/static/js/site.js"></script>

        <!-- green id -->
        {% if production %}
        <script src="https://simpleui-au.vixverify.com/df/javascripts/greenidConfig.js"></script>
		<script src="https://simpleui-au.vixverify.com/df/javascripts/greenidui.min.js"></script>
        {% else %}
        <script src="https://simpleui-test-au.vixverify.com/df/javascripts/greenidConfig.js"></script>
		<script src="https://simpleui-test-au.vixverify.com/df/javascripts/greenidui.min.js"></script>
        {% endif %}

        <!-- harmony -->
        <script src="/static/js/harmony-1.6.7.min.js"></script>
        <script src="/static/js/harmony-ui-1.6.7.min.js"></script>

        <!-- is-webview -->
        <script src="https://wzrd.in/standalone/is-webview@1.0.1"></script>

        <script type="text/javascript">                 
			
			$(document).ready(function() {
                {% if not completed %}
                    {% if not greenid_verification_token %}
                        $("#choose_verification").show();
                    {% else %}
                        $("#greenid_continue").show();
                        $("#greenid_div").show();
                    {% endif %}
                {% endif %}
			})

            function chooseEzyPay() {
                $("#ezypay_verification_message").hide();
                $("#choose_verification").hide();
                $("#ezypay_form").show();
            }

            function greenidUISetup() {
				// The setup function initialises the greenID Simple UI and passes in key variables, 
				// such as the div ID where the form controls will be injected and the ID of your form.
				// A full list of parameters is available at https://vixverify.atlassian.net/wiki/display/GREEN/Using+the+SimpleUI#UsingtheSimpleUI-JavascriptSetupforRegisteringaNewPerson
                {% if production %}
                var greenidEnvironment = "prod";
                {% else %}
                var greenidEnvironment = "test";
                {% endif %}
			    greenidUI.setup({
				    environment: greenidEnvironment,	
				    formId: "greenid_init_form",
				    frameId: "greenid_div",
				    country: "usethiscountry",
				    debug: true,
				    preSubmitValidationCallback: onValidation,
                    registerCallback: onRegister
			    });
            }

            function chooseGreenId() {
                $("#ezypay_verification_message").hide();
                $("#choose_verification").hide();

                greenidUISetup();

			    // if you want to override anything from the greenidConfig.js file, you would use this function
			    greenidConfig.setOverrides();

                initHarmony();

                $("#greenid_div").show();
                $("#greenid_init_form").show();
            }

            function continueGreenIdVerification() {
                {% if greenid_verification_token %}
                $("#greenid_continue").hide();
                greenidUISetup();
                greenidUI.show("{{account_id}}", "{{api_code}}", "{{greenid_verification_token}}");
                {% endif %}
            }

            function initHarmony() {
                Harmony.useEnv("https://hosted.mastersoftgroup.com");
                Harmony.init("{{harmony_user}}", "{{harmony_pass}}", Harmony.AUSTRALIA);

                // Use the JSONP protocol for compatibility with IE 8/9.
                Harmony.useProtocol(Harmony.JSONP);

                var opt = {
                    minLength: 3, 
                    skipTransaction: false,
                    onSelect: function(event, ui) {
                        console.log('address selected: ' + ui.item.fullAddress);
                    }
                };
                Harmony.UI.addressLookup($("#fullAddress"), Harmony.NZAD, opt);

                // Configure the output fields.
                Harmony.UI.addField(Harmony.SUBDWELLING, $("#flatNumber"));
                Harmony.UI.addField(Harmony.STREET_NUMBER, $("#streetNumber"));
                Harmony.UI.addField(Harmony.STREET_NAME, $("#streetName"));
                Harmony.UI.addField(Harmony.STREET_TYPE, $("#nzstreetType"));
                Harmony.UI.addField(Harmony.POSTCODE, $("#postcode"));
                
                Harmony.UI.addField(Harmony.SUBURB, $("#nzsuburb"));
                Harmony.UI.addField(Harmony.TOWN_CITY, $("#nztown"));

                var tid = setInterval(function() {
                    if (Harmony._transactionID !== null) {
                        $('#address-harmony-div').show();
                        $('#address-non-harmony-div').hide();
                        clearTimeout(tid);
                    }
                }, 500);
            }

            function workoutNZsuburb() {
                var realsuburb = document.getElementById('suburb');
                var nzsuburb = document.getElementById('nzsuburb');
                var nztown = document.getElementById('nztown');
                
                var nzstreettypeField = document.getElementById('nzstreetType');
                var realstreetTypeField = document.getElementById('streetType');
                var towncityField = document.getElementById('townCity');
                
                if(towncityField != null)
                {
                    if (nzsuburb != null && nzsuburb.value)
                    {
                        realsuburb.value = nzsuburb.value;	
                    }
                    
                    if (nztown != null && nztown.value)
                    {
                        towncityField.value = nztown.value;	
                    }
                }
                else
                {
                    if(nztown != null && nztown.value)
                    {
                        realsuburb.value = nztown.value;	
                    }
                }
                
                if(nzstreettypeField != null && realstreetTypeField !=null && nzstreettypeField.value)
                {
                    // swap id
                    realstreetTypeField.id = "nzstreetType";
                    nzstreettypeField.id = "streetType";
                }
            }

            {% if completed %}
            $(document).ready(function() {
                /* webview detection not working
                if (!isWebview(navigator.userAgent)) {
                    $("#return-to-parent").show();
                }
                */
                if (window.hasOwnProperty("ReactNativeWebView")) {
                    console.log("react native webview");
                    window.ReactNativeWebView.postMessage("kycCompleted");
                }
            });
            {% endif %}

		</script>

    </body>

</html>

